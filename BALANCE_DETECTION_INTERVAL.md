# 余额检测时间间隔说明

## 当前配置

### 余额变化检测间隔
**每 5 分钟自动检测一次**

- 首次加载：页面打开时立即检测
- 定期检测：每 5 分钟（300,000 毫秒）自动检测一次
- 手动刷新：用户刷新页面时检测

### 提醒列表刷新间隔
**每 30 秒刷新一次**

- 仅刷新已存在的提醒列表
- 不触发新的余额检测

## 实现位置

### 代码位置
`src/components/cases/case-dashboard-view.tsx`

```typescript
useEffect(() => {
    // ... fetchBalances 函数
    
    fetchBalances(); // 立即执行一次
    
    // 定期检测余额变化（每5分钟检测一次）
    const interval = setInterval(() => {
        fetchBalances();
    }, 5 * 60 * 1000); // 5分钟 = 300,000 毫秒
    
    return () => clearInterval(interval);
}, [data?.id]);
```

## 检测流程

1. **页面加载时**
   - 立即获取余额
   - 创建余额快照
   - 检测提醒规则
   - 显示提醒

2. **每 5 分钟**
   - 自动获取最新余额
   - 与上次快照比较
   - 如有变化，创建新快照
   - 检测是否触发提醒规则
   - 如有触发，创建提醒记录

3. **提醒列表**
   - 每 30 秒刷新一次
   - 显示最新的提醒状态

## 调整检测间隔

如果需要修改检测间隔，可以调整以下参数：

### 余额检测间隔
在 `case-dashboard-view.tsx` 中修改：

```typescript
// 当前：5分钟
const interval = setInterval(() => {
    fetchBalances();
}, 5 * 60 * 1000);

// 改为 1 分钟：
const interval = setInterval(() => {
    fetchBalances();
}, 1 * 60 * 1000);

// 改为 15 分钟：
const interval = setInterval(() => {
    fetchBalances();
}, 15 * 60 * 1000);
```

### 提醒列表刷新间隔
在 `alerts-list.tsx` 中修改：

```typescript
// 当前：30秒
const interval = setInterval(fetchAlerts, 30000);

// 改为 10 秒：
const interval = setInterval(fetchAlerts, 10000);
```

## 注意事项

1. **性能考虑**
   - 检测间隔太短会增加服务器负载
   - 检测间隔太长可能错过重要变化
   - 建议间隔：1-15 分钟

2. **用户离开页面**
   - 当用户离开页面时，定时器会自动清理
   - 不会在后台继续运行

3. **后台检测**
   - 如果需要后台持续检测，需要实现：
     - 服务端定时任务（Cron Job）
     - 或使用 Web Worker
     - 或使用服务端推送（WebSocket/SSE）

## 推荐配置

### 开发环境
- 余额检测：1-2 分钟
- 提醒刷新：10-15 秒

### 生产环境
- 余额检测：5-15 分钟
- 提醒刷新：30 秒

### 高频监控场景
- 余额检测：1-3 分钟
- 提醒刷新：10 秒

## 未来优化

1. **可配置的检测间隔**
   - 允许用户在设置中配置检测间隔
   - 不同 case 可以有不同的检测间隔

2. **智能检测**
   - 根据余额变化频率动态调整检测间隔
   - 余额稳定时降低检测频率
   - 余额频繁变化时提高检测频率

3. **后台服务**
   - 实现服务端定时任务
   - 即使页面关闭也能持续检测
   - 通过推送通知用户

