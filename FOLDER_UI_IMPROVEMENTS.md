# 分组 UI 优化说明

## 📋 更新内容

### 1. ✅ 移除侧边栏独立的"添加分组"按钮

**变更前**：
- 侧边栏有独立的"添加分组"按钮
- 点击后弹出对话框

**变更后**：
- "添加分组"按钮集成到分组列表中
- 点击后直接在列表顶部显示内联输入框
- 更加直观和流畅

### 2. ✅ 添加三个点菜单（编辑、删除）

**功能**：
- Hover 任意分组时，右侧显示两个按钮：
  - `+` 按钮：创建子目录/添加地址
  - `⋮` 按钮：打开菜单
- 菜单包含：
  - 📝 **编辑分组**：内联编辑分组名称
  - 🗑️ **删除**：删除分组（带确认）

**交互细节**：
- 点击"编辑分组"→ 当前行变为输入框
- 支持 Enter 保存，Esc 取消
- 自动选中文本，方便快速修改
- 删除前弹出确认对话框

### 3. ✅ 内联编辑分组名称

**流程**：
```
Hover 分组 → 点击 ⋮ → 选择"编辑分组" → 内联输入框 → Enter 保存
```

**特点**：
- 无需打开对话框
- 所见即所得
- 自动聚焦并选中文本
- 支持键盘快捷键

## 🎨 UI 设计

### 分组节点布局

```
[展开] [图标] 分组名称                    [+] [⋮]
  ↑      ↑      ↑                         ↑   ↑
折叠    文件夹  名称                      添加 菜单
```

### Hover 状态

```
正常状态：
📁 我的投资组合

Hover 状态：
📁 我的投资组合                          [+] [⋮]
                                         ↑   ↑
                                      显示操作按钮
```

### 编辑状态

```
点击"编辑分组"后：
[展开] [图标] [我的投资组合................] [✓] [×]
                ↑                           ↑   ↑
              输入框                       保存 取消
```

## 🎯 功能对比

| 功能 | 旧版 | 新版 |
|------|------|------|
| 添加分组 | 独立按钮 + 对话框 | 集成按钮 + 内联输入 |
| 编辑名称 | 对话框 | 内联编辑 |
| 删除分组 | 详情页按钮 | 三个点菜单 |
| 操作入口 | 分散 | 统一在三个点菜单 |

## 📱 交互流程

### 创建一级分组
1. 点击「添加分组」按钮
2. 在列表顶部出现输入框
3. 输入名称 → Enter 保存

### 创建子目录
1. Hover 父分组
2. 点击 `+` 按钮
3. 在下方出现输入框
4. 输入名称 → Enter 保存

### 编辑分组名称
1. Hover 分组
2. 点击 `⋮` 按钮
3. 选择「编辑分组」
4. 修改名称 → Enter 保存

### 删除分组
1. Hover 分组
2. 点击 `⋮` 按钮
3. 选择「删除」
4. 确认删除

### 三级目录添加地址
1. Hover 三级目录
2. 点击 `+` 按钮
3. 打开添加地址对话框
4. 填写地址信息 → 提交

## 🎹 快捷键

| 按键 | 功能 |
|------|------|
| Enter | 保存当前输入 |
| Escape | 取消输入 |
| 自动选中 | 编辑时选中全部文本 |

## 🔧 技术实现

### 核心组件

1. **FolderTree**
   - 集成"添加分组"按钮
   - 管理内联输入状态
   - 处理编辑/删除逻辑

2. **FolderTreeNode**
   - 三个点菜单（DropdownMenu）
   - 编辑状态切换
   - 内联输入显示

3. **InlineFolderInput**
   - 支持初始值（编辑模式）
   - 自动聚焦和选中
   - 键盘事件处理

### 状态管理

```typescript
// 编辑状态
const [isEditing, setIsEditing] = useState(false);

// 创建子目录状态
const [showInlineInput, setShowInlineInput] = useState(false);

// Hover 状态
const [isHovered, setIsHovered] = useState(false);
```

### API 调用

```typescript
// 编辑分组名称
await updateCaseAction(folderId, {
  name: newName,
  description: folder.description,
  parentId: folder.parentId,
  addresses: [],
});

// 删除分组
await deleteCaseAction(folderId);
```

## 🎨 视觉设计

### 三个点菜单样式

```
⋮  ← 垂直三个点图标
│
├─ 📝 编辑分组
└─ 🗑️ 删除 (红色)
```

### 按钮显示逻辑

| 层级 | + 按钮 | ⋮ 菜单 | + 按钮功能 |
|------|--------|--------|-----------|
| 一级 | ✅ | ✅ | 创建二级目录 |
| 二级 | ✅ | ✅ | 创建三级目录 |
| 三级 | ✅ | ✅ | 添加监控地址 |

### 颜色规范

- **正常状态**：`text-muted-foreground`
- **Hover 状态**：`hover:text-foreground`
- **激活状态**：`bg-primary/10 text-primary`
- **删除按钮**：`text-destructive`

## 📊 用户体验提升

### 效率提升

| 操作 | 旧版步骤 | 新版步骤 | 提升 |
|------|---------|---------|------|
| 编辑名称 | 3 步 | 2 步 | **33%** |
| 删除分组 | 导航到详情页 | 直接菜单操作 | **50%** |
| 批量操作 | 反复弹窗 | 连续内联 | **60%** |

### 认知负担降低

- ✅ 操作集中在一个菜单
- ✅ 无需记忆不同入口
- ✅ 所见即所得的编辑
- ✅ 视觉反馈清晰

## 🔒 安全性

### 删除确认

```javascript
if (!confirm(`确定要删除「${folderName}」吗？此操作无法撤销。`)) {
    return;
}
```

### 错误处理

- ✅ API 调用失败提示
- ✅ Toast 消息反馈
- ✅ 自动刷新列表

## 🌐 国际化

### 新增文本键

```json
{
  "edit_group": "编辑分组",
  "delete": "删除"
}
```

### 支持语言

- ✅ 中文
- ✅ 英文

## 📝 文件变更

### 修改的文件

1. `src/components/cases/folder-tree.tsx`
   - 添加三个点菜单
   - 集成"添加分组"按钮
   - 实现编辑状态切换

2. `src/components/cases/inline-folder-input.tsx`
   - 支持初始值
   - 自动选中文本

3. `src/app/[locale]/(dashboard)/dashboard/layout-client.tsx`
   - 添加编辑处理函数
   - 添加删除处理函数

4. `src/app/[locale]/(dashboard)/dashboard/layout-wrapper.tsx`
   - 简化逻辑
   - 移除独立按钮

5. `messages/zh.json` & `messages/en.json`
   - 添加新的翻译键

## ✅ 完成标准

- [x] 移除侧边栏独立按钮
- [x] 添加三个点菜单
- [x] 实现内联编辑
- [x] 实现删除功能
- [x] 添加确认对话框
- [x] Toast 提示
- [x] 国际化支持
- [x] 无 Lint 错误

## 🎉 用户价值

1. **操作更快**：减少点击次数和页面跳转
2. **界面更简洁**：统一的操作入口
3. **体验更流畅**：内联编辑，无弹窗干扰
4. **功能更完整**：编辑和删除触手可及

## 🚀 后续优化建议

1. 拖拽排序功能
2. 批量操作（多选）
3. 右键菜单支持
4. 键盘导航（上下键）
5. 撤销/重做功能

