# 内联编辑交互体验说明

## 🎯 设计目标

提供更流畅、更直观的分组创建体验，用户无需在对话框中填写表单，可以直接在目录树中内联输入名称。

## ✨ 交互流程

### 1. 创建一级分组（顶级）

**操作步骤**：
1. 点击侧边栏「添加分组」按钮
2. 在目录树顶部出现内联输入框
3. 输入分组名称
4. 按 `Enter` 保存，或点击 ✓ 按钮
5. 按 `Esc` 取消，或点击 × 按钮

**特点**：
- ✅ 无需弹窗，直接在列表中输入
- ✅ 自动聚焦到输入框
- ✅ 支持键盘快捷键
- ✅ 创建的是空分组（无监控地址）

### 2. 创建二级目录

**操作步骤**：
1. Hover 一级分组
2. 右侧显示 `+` 按钮
3. 点击 `+` 按钮
4. 在该分组下方出现内联输入框（带缩进）
5. 输入目录名称
6. 按 `Enter` 保存或 `Esc` 取消

**特点**：
- ✅ 自动展开父目录
- ✅ 缩进对齐，视觉层次清晰
- ✅ 输入框带有占位符提示

### 3. 创建三级目录

**操作步骤**：
1. Hover 二级目录
2. 右侧显示 `+` 按钮
3. 点击 `+` 按钮
4. 在该目录下方出现内联输入框（更深缩进）
5. 输入目录名称
6. 按 `Enter` 保存或 `Esc` 取消

### 4. 三级目录添加监控地址

**操作步骤**：
1. Hover 三级目录
2. 右侧显示 `+` 按钮（提示：添加监控地址）
3. 点击 `+` 按钮
4. 弹出「添加监控地址」对话框
5. 填写地址信息
6. 提交保存

**特点**：
- ✅ 三级目录专用于添加地址
- ✅ 不能再创建子目录（已达最大层级）
- ✅ 对话框显示当前分组名称

## 🎨 视觉设计

### 内联输入框样式

```
[空] [空] [输入框...............] [✓] [×]
     ↑    ↑                        ↑   ↑
    图标  输入框                   保存 取消
    对齐
```

- **背景色**：`bg-muted/50`
- **边框**：虚线边框 `border-dashed border-primary/50`
- **高度**：与目录项一致（`h-7`）
- **图标**：
  - ✓ 绿色，表示确认
  - × 灰色，hover 变红色

### 缩进层级

```
📁 我的投资组合 (Level 1)          [+]
    [输入二级目录名称...]           [✓] [×]
  📂 交易所账户 (Level 2)           [+]
      [输入三级目录名称...]         [✓] [×]
    📂 币安 (Level 3)                [+]  ← 点击打开地址对话框
```

## 🎹 键盘快捷键

- **Enter**：保存当前输入
- **Escape**：取消输入并关闭输入框
- **自动聚焦**：输入框出现时自动获得焦点

## 🔄 交互状态

### 添加分组按钮

- **正常状态**：显示「添加分组」
- **输入中**：按钮禁用（`disabled`）
- **输入完成**：按钮恢复可用

### + 按钮显示逻辑

| 层级 | Hover 显示 | 点击行为 |
|------|-----------|---------|
| 一级 | ✅ | 显示二级目录输入框 |
| 二级 | ✅ | 显示三级目录输入框 |
| 三级 | ✅ | 打开添加地址对话框 |

## 📡 API 变化

### 创建分组（支持空地址）

```typescript
POST /api/cases/create
{
  name: string,
  parentId?: string | null,
  addresses: []  // 现在可以为空
}
```

### 添加地址到现有分组

```typescript
POST /api/cases/:caseId/addresses
{
  addresses: [
    {
      address: string,
      chain: "BTC" | "ETH" | "TRON",
      network?: "L1" | "L2"
    }
  ]
}
```

## 🎯 用户场景

### 场景 1：快速创建分组结构

```
用户想创建：我的资产 > 交易所 > 币安

步骤：
1. 点击「添加分组」→ 输入"我的资产" → Enter
2. Hover "我的资产" → 点击 + → 输入"交易所" → Enter
3. Hover "交易所" → 点击 + → 输入"币安" → Enter
4. Hover "币安" → 点击 + → 在对话框中添加地址
```

### 场景 2：批量创建空分组

```
用户想先建立目录结构，稍后添加地址

优势：
- 无需每次都填写地址表单
- 可以快速建立层级结构
- 后续再统一添加地址
```

## 🚀 性能优化

- **自动刷新**：创建成功后自动 `router.refresh()`
- **Toast 提示**：操作反馈清晰
- **防重复提交**：提交中禁用按钮
- **输入验证**：空白名称不允许保存

## 📱 响应式设计

- **桌面端**：完整交互体验
- **移动端**：（待实现）简化版交互

## 🔧 技术实现

### 核心组件

1. **InlineFolderInput** - 内联输入组件
   - 自动聚焦
   - 键盘事件处理
   - 视觉对齐

2. **FolderTree** - 树形展示组件
   - 内联输入状态管理
   - 递归渲染
   - 不同层级的按钮逻辑

3. **AddAddressDialog** - 添加地址对话框
   - 专用于三级目录
   - 表单验证
   - API 调用

### 状态管理

```typescript
// LayoutWrapper - 管理顶级输入状态
const [showCreateRoot, setShowCreateRoot] = useState(false);

// FolderTreeNode - 管理子目录输入状态
const [showInlineInput, setShowInlineInput] = useState(false);

// LayoutClient - 管理地址对话框状态
const [addressDialogOpen, setAddressDialogOpen] = useState(false);
```

## 🎓 用户学习曲线

- **0 秒**：点击按钮即可看到输入框，无需学习
- **直观**：输入框位置直接对应层级关系
- **容错**：按 Esc 随时取消，无损失

## 📊 与旧版对话框的对比

| 特性 | 旧版（对话框） | 新版（内联） |
|------|--------------|-------------|
| 点击次数 | 3-4 次 | 2-3 次 |
| 视觉焦点 | 弹窗覆盖 | 在列表中 |
| 层级感知 | 需要理解 parentId | 直接看到位置 |
| 创建速度 | 慢（填表单） | 快（只输名称） |
| 批量创建 | 繁琐 | 流畅 |

## ✅ 完成标准

- [x] 一级分组内联输入
- [x] 二级目录内联输入
- [x] 三级目录内联输入
- [x] 三级目录添加地址对话框
- [x] 键盘快捷键支持
- [x] 自动聚焦
- [x] 视觉层次清晰
- [x] 后端 API 支持
- [x] 错误处理
- [x] Toast 提示

## 🎉 用户价值

1. **效率提升**：减少 50% 的点击次数
2. **体验提升**：无弹窗干扰，视觉连贯
3. **认知降低**：所见即所得，无需理解抽象概念
4. **灵活性**：可以先建结构，后加内容

